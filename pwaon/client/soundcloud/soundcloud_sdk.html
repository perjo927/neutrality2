<template name="soundcloud_sdk">
    <nav class="pink">
        <div class="nav-wrapper">
            <a href="#" class="brand-logo center white-text">SoundCloud Uploader</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
            </ul>
        </div>
    </nav>

    <div class="row">
        <div class="container section center">
            <h2>Welcome {{#if Session 'SC'}} {{userName}}{{/if}}</h2>
        </div>

        <a id="record" class="waves-effect waves-light btn red">
            <i class="material-icons right"></i>Record
        </a>
    </div>


    <script>
        var that = this;

        // TODO: Authentication works in prod, not in localhost
        Meteor.call("parseAssets", "clientId", function (err,res) {
            if(!!err) {
                //
            } else {
                var clientId = res;
                var rootUrl = Meteor.absoluteUrl();
                var redirectUri = rootUrl + "callback";

                // initialize client with app credentials
                that.SC.initialize({
                    client_id: clientId,
                    redirect_uri: redirectUri
                });

                // initiate auth popup
                that.SC.connect(function() {
                    that.SC.get('/me', function(me) {
                        Session.set("SC", me);
                    });
                });
            }
        });
    </script>
</template>